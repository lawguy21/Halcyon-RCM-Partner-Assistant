version: '3.8'

services:
  # White-label configuration - customize these for each partner
  # Partner Name: ${PARTNER_NAME:-RCM Partner}

  api:
    build:
      context: ..
      dockerfile: docker/Dockerfile.api
      args:
        BRAND_NAME: ${BRAND_NAME:-RCM Partner}
        BUILD_VERSION: ${BUILD_VERSION:-dev}
        BUILD_DATE: ${BUILD_DATE:-}
        NODE_ENV: ${NODE_ENV:-production}
    container_name: ${CONTAINER_PREFIX:-rcm}-api
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - JWT_SECRET=${JWT_SECRET}
      - BRAND_NAME=${BRAND_NAME:-RCM Partner}
      - NODE_ENV=${NODE_ENV:-production}
      - PORT=3001
    ports:
      - "${API_PORT:-3001}:3001"
    depends_on:
      - db

  web:
    build:
      context: ..
      dockerfile: docker/Dockerfile.web
      args:
        NEXT_PUBLIC_BRAND_NAME: ${BRAND_NAME:-RCM Partner}
        NEXT_PUBLIC_PRIMARY_COLOR: ${PRIMARY_COLOR:-#2563eb}
        NEXT_PUBLIC_SUPPORT_EMAIL: ${SUPPORT_EMAIL:-}
        NEXT_PUBLIC_API_URL: ${API_URL:-http://api:3001}
    container_name: ${CONTAINER_PREFIX:-rcm}-web
    ports:
      - "${WEB_PORT:-3000}:3000"
    depends_on:
      - api

  db:
    image: postgres:15-alpine
    container_name: ${CONTAINER_PREFIX:-rcm}-db
    environment:
      - POSTGRES_USER=${DB_USER:-postgres}
      - POSTGRES_PASSWORD=${DB_PASSWORD:-postgres}
      - POSTGRES_DB=${DB_NAME:-rcm}
    volumes:
      - pgdata:/var/lib/postgresql/data
    ports:
      - "${DB_PORT:-5432}:5432"

volumes:
  pgdata:
